Profile Optimized Eval Results
Date: 2025-12-17 12:03:47
Device: cuda
Dataset: family

Configuration:
  Queries: 100
  Corruptions: 100
  Corruption modes: ['both']
  Compile mode: reduce-overhead
  Fullgraph: True

Setting up components...
Queries loaded - Train: 19845/19845, Valid: 2799, Test: 5626
  Total candidates: 10100

Running warmup (compilation)...
Using Automatic Mixed Precision (AMP) with dtype: torch.bfloat16
Compiling env.step (mode='reduce-overhead', fullgraph=True)...
Warmup time: 18.04s

Profiling evaluation...

================================================================================
TIMING SUMMARY
================================================================================
Warmup time:      18.0361s
Runtime:          18.4762s
Total time:       36.5123s
ms/query:         184.762
ms/candidate:     1.829

MRR:              0.5036
Hits@1:           0.4300
Hits@10:          0.6600

================================================================================
PROFILING RESULTS - Top by Cumulative Time
================================================================================
         358108 function calls (351895 primitive calls) in 3.192 seconds

   Ordered by: cumulative time
   List reduced from 543 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       20    0.002    0.000    2.319    0.116 env.py:247(init_state_from_queries)
       20    2.130    0.107    2.307    0.115 env.py:438(_compute_derived_functional)
    426/6    0.219    0.001    0.563    0.094 eval_frame.py:791(compile_wrapper)
     2400    0.018    0.000    0.372    0.000 eval_frame.py:1039(_fn)
      800    0.002    0.000    0.333    0.000 aot_autograd.py:1126(forward)
      800    0.003    0.000    0.330    0.000 runtime_wrappers.py:310(runtime_wrapper)
     23/2    0.002    0.000    0.329    0.165 env.py:852(step)
      800    0.007    0.000    0.326    0.000 utils.py:119(call_func_at_runtime_with_args)
      800    0.003    0.000    0.314    0.000 runtime_wrappers.py:716(inner_fn)
      800    0.001    0.000    0.311    0.000 runtime_wrappers.py:512(wrapper)
      800    0.007    0.000    0.310    0.000 output_code.py:590(__call__)
      800    0.003    0.000    0.232    0.000 compile_fx.py:1767(run)
      800    0.001    0.000    0.229    0.000 cudagraph_trees.py:378(deferred_cudagraphify)
      800    0.003    0.000    0.228    0.000 utils.py:3013(run)
      400    0.026    0.000    0.223    0.001 model.py:795(policy_fn)
      400    0.032    0.000    0.218    0.001 env.py:690(_step_impl)
 1599/800    0.011    0.000    0.218    0.000 cudagraph_trees.py:2008(run)
 1599/800    0.003    0.000    0.207    0.000 cudagraph_trees.py:2073(_run)
      800    0.005    0.000    0.173    0.000 cudagraph_trees.py:2241(execute_node)
      800    0.004    0.000    0.149    0.000 cudagraph_trees.py:1105(run)
      400    0.002    0.000    0.138    0.000 cobpinoqnqmol5bad3hnv5xvqaznstd4ktnn2e2k35g44jjyu3kv.py:5768(call)
       20    0.014    0.001    0.134    0.007 unification.py:1184(get_derived_states_compiled)
      800    0.002    0.000    0.131    0.000 cudagraph_trees.py:1219(run_graph)
      400    0.003    0.000    0.126    0.000 chsf7f66fhatsfh636jwhgv53shy77jz7abbrckmz4kjwpquvvtt.py:1431(call)
      800    0.011    0.000    0.108    0.000 cudagraph_trees.py:1057(_copy_inputs_and_remove_from_src)
      800    0.092    0.000    0.092    0.000 {built-in method torch._foreach_copy_}
     6142    0.074    0.000    0.074    0.000 {method 'clone' of 'torch._C.TensorBase' objects}
     1861    0.038    0.000    0.038    0.000 {built-in method torch.where}
      800    0.005    0.000    0.038    0.000 profiler.py:789(__exit__)
      800    0.001    0.000    0.032    0.000 _ops.py:1068(__call__)
       20    0.005    0.000    0.031    0.002 unification.py:582(unify_with_facts)
       40    0.017    0.000    0.026    0.001 unification.py:132(unify_one_to_one)
       20    0.006    0.000    0.025    0.001 unification.py:664(unify_with_rules)
      800    0.001    0.000    0.023    0.000 _ops.py:1128(_must_dispatch_in_python)
      800    0.001    0.000    0.022    0.000 _pytree.py:1630(tree_any)
      741    0.021    0.000    0.021    0.000 {built-in method torch.full_like}
      800    0.021    0.000    0.021    0.000 graphs.py:139(replay)
      800    0.001    0.000    0.021    0.000 {built-in method builtins.any}
       20    0.001    0.000    0.020    0.001 unification.py:912(pack_results)
        1    0.000    0.000    0.020    0.020 ppo.py:34(compute_metrics_from_ranks)




================================================================================
PROFILING RESULTS - Top by Total Time
================================================================================
         358108 function calls (351895 primitive calls) in 3.192 seconds

   Ordered by: internal time
   List reduced from 543 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       20    2.130    0.107    2.307    0.115 env.py:438(_compute_derived_functional)
    426/6    0.219    0.001    0.563    0.094 eval_frame.py:791(compile_wrapper)
      800    0.092    0.000    0.092    0.000 {built-in method torch._foreach_copy_}
     6142    0.074    0.000    0.074    0.000 {method 'clone' of 'torch._C.TensorBase' objects}
     1861    0.038    0.000    0.038    0.000 {built-in method torch.where}
      400    0.032    0.000    0.218    0.001 env.py:690(_step_impl)
      400    0.026    0.000    0.223    0.001 model.py:795(policy_fn)
      741    0.021    0.000    0.021    0.000 {built-in method torch.full_like}
      800    0.021    0.000    0.021    0.000 graphs.py:139(replay)
     2400    0.018    0.000    0.372    0.000 eval_frame.py:1039(_fn)
      800    0.017    0.000    0.017    0.000 {built-in method torch._ops.profiler._record_function_enter_new}
       40    0.017    0.000    0.026    0.001 unification.py:132(unify_one_to_one)
       20    0.014    0.001    0.134    0.007 unification.py:1184(get_derived_states_compiled)
      400    0.013    0.000    0.013    0.000 {method 'argmax' of 'torch._C.TensorBase' objects}
      189    0.012    0.000    0.012    0.000 {built-in method torch.cat}
    60/40    0.012    0.000    0.015    0.000 env.py:309(_compute_state_hash64)
 1599/800    0.011    0.000    0.218    0.000 cudagraph_trees.py:2008(run)
        4    0.011    0.003    0.011    0.003 {built-in method torch.mean}
      800    0.011    0.000    0.108    0.000 cudagraph_trees.py:1057(_copy_inputs_and_remove_from_src)
      560    0.011    0.000    0.011    0.000 {method 'all' of 'torch._C.TensorBase' objects}
      303    0.010    0.000    0.010    0.000 {method 'sum' of 'torch._C.TensorBase' objects}
      400    0.009    0.000    0.009    0.000 {built-in method torch.log_softmax}
     5600    0.009    0.000    0.014    0.000 _config_module.py:370(__getattr__)
      400    0.009    0.000    0.009    0.000 {method 'gather' of 'torch._C.TensorBase' objects}
      521    0.008    0.000    0.008    0.000 {built-in method torch.zeros_like}
     2023    0.008    0.000    0.008    0.000 {method 'unsqueeze' of 'torch._C.TensorBase' objects}
        1    0.008    0.008    0.008    0.008 {method 'reciprocal' of 'torch._C.TensorBase' objects}
      800    0.008    0.000    0.008    0.000 {built-in method torch._ops.profiler.}
        1    0.008    0.008    0.014    0.014 sampler.py:123(corrupt)
      800    0.007    0.000    0.310    0.000 output_code.py:590(__call__)
      200    0.007    0.000    0.007    0.000 {built-in method torch.full}
    48284    0.007    0.000    0.007    0.000 {built-in method builtins.isinstance}
      800    0.007    0.000    0.326    0.000 utils.py:119(call_func_at_runtime_with_args)
       20    0.006    0.000    0.011    0.001 env.py:626(_add_end_action_functional)
      800    0.006    0.000    0.008    0.000 cudagraph_trees.py:1126(reconstruct_outputs)
     1599    0.006    0.000    0.010    0.000 cudagraph_trees.py:2062(exceed_rerecord_limit)
      800    0.006    0.000    0.010    0.000 __init__.py:373(cudagraph_mark_step_begin)
5600/1600    0.006    0.000    0.018    0.000 _pytree.py:1302(tree_iter)
       20    0.006    0.000    0.025    0.001 unification.py:664(unify_with_rules)
      800    0.005    0.000    0.038    0.000 profiler.py:789(__exit__)




================================================================================
WALLCLOCK SUMMARY
================================================================================
Initial wallclock: 1765969426.0586
Final wallclock:   1765969466.6273
Total wallclock:   40.5687s

Results saved to /home/castellanoontiv/Batched_env/kge_experiments/tests/profile_eval_results.txt
