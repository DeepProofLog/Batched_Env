Profile Optimized Eval Results
Date: 2025-12-17 11:33:25
Device: cuda
Dataset: family

Configuration:
  Queries: 100
  Corruptions: 100
  Corruption modes: ['both']
  Compile mode: reduce-overhead
  Fullgraph: True

Setting up components...
Queries loaded - Train: 19845/19845, Valid: 2799, Test: 5626
  Total candidates: 10100

Running warmup (compilation)...
Using Automatic Mixed Precision (AMP) with dtype: torch.bfloat16
Compiling step_with_policy (mode='reduce-overhead', fullgraph=True)...
Warmup time: 5.59s

Profiling evaluation...

================================================================================
TIMING SUMMARY
================================================================================
Warmup time:      5.5861s
Runtime:          18.3131s
Total time:       23.8992s
ms/query:         183.131
ms/candidate:     1.813

MRR:              0.4926
Hits@1:           0.4100
Hits@10:          0.6400

================================================================================
PROFILING RESULTS - Top by Cumulative Time
================================================================================
         263513 function calls (257740 primitive calls) in 3.920 seconds

   Ordered by: cumulative time
   List reduced from 750 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       20    0.002    0.000    2.330    0.117 env.py:247(init_state_from_queries)
       20    2.116    0.106    2.320    0.116 env.py:438(_compute_derived_functional)
      400    0.002    0.000    0.399    0.001 runtime_wrappers.py:310(runtime_wrapper)
      400    0.005    0.000    0.397    0.001 utils.py:119(call_func_at_runtime_with_args)
      400    0.002    0.000    0.388    0.001 runtime_wrappers.py:512(wrapper)
      400    0.005    0.000    0.386    0.001 output_code.py:590(__call__)
      400    0.002    0.000    0.318    0.001 compile_fx.py:1767(run)
      400    0.001    0.000    0.315    0.001 cudagraph_trees.py:378(deferred_cudagraphify)
      400    0.002    0.000    0.315    0.001 utils.py:3013(run)
  797/400    0.008    0.000    0.308    0.001 cudagraph_trees.py:2008(run)
  797/400    0.002    0.000    0.297    0.001 cudagraph_trees.py:2073(_run)
      380    0.004    0.000    0.262    0.001 ca7c2z2kpxjrlqcp4bkdz6rxor6ubrcqcjmoi2gas5h3wfphmklw.py:7276(call)
     44/1    0.941    0.021    0.224    0.224 env.py:1037(step_with_policy)
    399/1    0.007    0.000    0.223    0.223 eval_frame.py:791(compile_wrapper)
   1199/5    0.015    0.000    0.208    0.042 eval_frame.py:1039(_fn)
    399/1    0.002    0.000    0.208    0.208 aot_autograd.py:1126(forward)
      398    0.003    0.000    0.158    0.000 cudagraph_trees.py:2241(execute_node)
       20    0.013    0.001    0.155    0.008 unification.py:1184(get_derived_states_compiled)
      398    0.004    0.000    0.142    0.000 cudagraph_trees.py:1105(run)
      398    0.002    0.000    0.123    0.000 cudagraph_trees.py:1219(run_graph)
        2    0.000    0.000    0.118    0.059 cudagraph_trees.py:2205(record_function)
      400    0.010    0.000    0.102    0.000 cudagraph_trees.py:1057(_copy_inputs_and_remove_from_src)
     8142    0.094    0.000    0.094    0.000 {method 'clone' of 'torch._C.TensorBase' objects}
  402/400    0.088    0.000    0.088    0.000 {built-in method torch._foreach_copy_}
       12    0.000    0.000    0.083    0.007 __init__.py:1073(synchronize)
       12    0.082    0.007    0.082    0.007 {built-in method torch._C._cuda_synchronize}
       20    0.000    0.000    0.082    0.004 ccjuu4cztryapmbzuzdtro4fud73q6x22jbb6vkdbhasft7oazjj.py:7274(call)
      400    0.019    0.000    0.055    0.000 graphs.py:139(replay)
       20    0.005    0.000    0.040    0.002 unification.py:582(unify_with_facts)
        2    0.000    0.000    0.036    0.018 cudagraph_trees.py:815(__init__)
        2    0.000    0.000    0.035    0.018 cudagraph_trees.py:1230(_record)
        2    0.000    0.000    0.034    0.017 graphs.py:264(__exit__)
       40    0.018    0.000    0.031    0.001 unification.py:132(unify_one_to_one)
      402    0.006    0.000    0.031    0.000 profiler.py:789(__exit__)
       20    0.001    0.000    0.031    0.002 unification.py:912(pack_results)
       20    0.005    0.000    0.026    0.001 unification.py:664(unify_with_rules)
       20    0.005    0.000    0.025    0.001 env.py:360(_prune_visited_states)
      402    0.001    0.000    0.025    0.000 _ops.py:1068(__call__)
     1061    0.023    0.000    0.023    0.000 {built-in method torch.where}
        2    0.000    0.000    0.022    0.011 graphs.py:240(__enter__)




================================================================================
PROFILING RESULTS - Top by Total Time
================================================================================
         263513 function calls (257740 primitive calls) in 3.920 seconds

   Ordered by: internal time
   List reduced from 750 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       20    2.116    0.106    2.320    0.116 env.py:438(_compute_derived_functional)
     44/1    0.941    0.021    0.224    0.224 env.py:1037(step_with_policy)
     8142    0.094    0.000    0.094    0.000 {method 'clone' of 'torch._C.TensorBase' objects}
  402/400    0.088    0.000    0.088    0.000 {built-in method torch._foreach_copy_}
       12    0.082    0.007    0.082    0.007 {built-in method torch._C._cuda_synchronize}
    379/0    0.044    0.000    0.000          env.py:882(_step_with_policy_impl)
     1061    0.023    0.000    0.023    0.000 {built-in method torch.where}
        2    0.021    0.010    0.021    0.010 {built-in method torch._C._cuda_emptyCache}
      189    0.020    0.000    0.020    0.000 {built-in method torch.cat}
      400    0.019    0.000    0.055    0.000 graphs.py:139(replay)
       40    0.018    0.000    0.031    0.001 unification.py:132(unify_one_to_one)
   1199/5    0.015    0.000    0.208    0.042 eval_frame.py:1039(_fn)
      560    0.014    0.000    0.014    0.000 {method 'all' of 'torch._C.TensorBase' objects}
       20    0.013    0.001    0.155    0.008 unification.py:1184(get_derived_states_compiled)
    60/40    0.013    0.000    0.017    0.000 env.py:309(_compute_state_hash64)
      402    0.012    0.000    0.012    0.000 {built-in method torch._ops.profiler._record_function_enter_new}
      303    0.010    0.000    0.010    0.000 {method 'sum' of 'torch._C.TensorBase' objects}
      400    0.010    0.000    0.102    0.000 cudagraph_trees.py:1057(_copy_inputs_and_remove_from_src)
      200    0.009    0.000    0.009    0.000 {built-in method torch.full}
      341    0.009    0.000    0.009    0.000 {built-in method torch.full_like}
        1    0.009    0.009    0.009    0.009 {built-in method torch.rand}
        4    0.009    0.002    0.009    0.002 {built-in method torch.mean}
      398    0.008    0.000    0.011    0.000 cudagraph_trees.py:1126(reconstruct_outputs)
  797/400    0.008    0.000    0.308    0.001 cudagraph_trees.py:2008(run)
        1    0.007    0.007    0.007    0.007 {method 'reciprocal' of 'torch._C.TensorBase' objects}
     3855    0.007    0.000    0.011    0.000 _config_module.py:370(__getattr__)
       40    0.007    0.000    0.007    0.000 {method 'flip' of 'torch._C.TensorBase' objects}
    399/1    0.007    0.000    0.223    0.223 eval_frame.py:791(compile_wrapper)
       20    0.006    0.000    0.011    0.001 env.py:626(_add_end_action_functional)
    44006    0.006    0.000    0.006    0.000 {built-in method builtins.isinstance}
      402    0.006    0.000    0.006    0.000 {built-in method torch._ops.profiler.}
      402    0.006    0.000    0.031    0.000 profiler.py:789(__exit__)
        1    0.006    0.006    0.013    0.013 sampler.py:123(corrupt)
      474    0.006    0.000    0.006    0.000 {built-in method torch._C._dynamo.guards._reinterpret_tensor}
       20    0.005    0.000    0.026    0.001 unification.py:664(unify_with_rules)
      400    0.005    0.000    0.386    0.001 output_code.py:590(__call__)
     1623    0.005    0.000    0.005    0.000 {method 'unsqueeze' of 'torch._C.TensorBase' objects}
       20    0.005    0.000    0.025    0.001 env.py:360(_prune_visited_states)
       20    0.005    0.000    0.040    0.002 unification.py:582(unify_with_facts)
       40    0.005    0.000    0.013    0.000 unification.py:85(apply_substitutions)




================================================================================
WALLCLOCK SUMMARY
================================================================================
Initial wallclock: 1765967603.3065
Final wallclock:   1765967631.3336
Total wallclock:   28.0271s

Results saved to /home/castellanoontiv/Batched_env/kge_experiments/tests/profile_eval_results.txt
