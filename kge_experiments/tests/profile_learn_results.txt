Profile Optimized Learn Results
Date: 2025-12-17 23:43:06
Device: cuda
Dataset: countries_s3

Configuration:
  Total timesteps (profiled): 1
  Batch size env: 128
  N steps per rollout: 128
  N epochs: 5
  Minibatch size: 1024
  Compile mode: reduce-overhead
  Fullgraph: True


Setting up components...
Queries loaded - Train: 111/111, Valid: 24, Test: 24
Compiling policy network and loss module for training...
Initialization time: 3.01s

Running warmup (compilation + first rollout)...
Compiling env.step (mode='reduce-overhead', fullgraph=True)...
Warmup: Running learn() iteration to compile all graphs...

Collecting rollouts
Rollout: 0/128
Rollout: 25/128
Rollout: 50/128
Rollout: 75/128
Rollout: 100/128
Rollout: 125/128
Rollout collected in 8.53s. FPS: 1919.76


Training
Epoch 1/5
Epoch 2/5
Epoch 3/5
Epoch 4/5
Epoch 5/5
Training completed in 11.25s
Iteration 1, timesteps: 16384/128.  total loss: 0.4352, policy_loss: 0.0052, value_loss: 0.4301, entropy_loss: 0.0259, approx_kl: 0.1962, clip_fraction: 0.0548, explained_var: -8.2634

Warmup time: 19.90s

Profiling training for 1 timesteps...

Collecting rollouts
Rollout: 0/128
Rollout: 25/128
Rollout: 50/128
Rollout: 75/128
Rollout: 100/128
Rollout: 125/128
Rollout collected in 0.97s. FPS: 16822.90


Training
Epoch 1/5
Epoch 2/5
Epoch 3/5
Epoch 4/5
Epoch 5/5
Training completed in 1.76s
Iteration 1, timesteps: 32768/16385.  total loss: 0.0594, policy_loss: 0.0038, value_loss: 0.0556, entropy_loss: 0.0205, approx_kl: 0.2530, clip_fraction: 0.0528, explained_var: -0.6585


================================================================================
TIMING SUMMARY
================================================================================
Init time:         3.0091s
Warmup time:       19.8979s
Runtime:           2.7569s
Total time:        22.6549s
Steps/second:      5942.8
Total timesteps:   32768 (Warmup: 16384, Profiled: 16384)

Last training metrics:
  policy_loss: 0.0038
  value_loss: 0.0556
  entropy: 0.0205
  clip_fraction: 0.0528
  approx_kl: 0.2530
  explained_var: -0.6585

================================================================================
PROFILING RESULTS - Top by Cumulative Time
================================================================================
         615979 function calls (569093 primitive calls) in 2.705 seconds

   Ordered by: cumulative time
   List reduced from 561 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       80    0.000    0.000    1.288    0.016 __init__.py:243(backward)
       80    0.001    0.000    1.287    0.016 graph.py:832(_engine_run_backward)
       80    1.139    0.014    1.283    0.016 {method 'run_backward' of 'torch._C._EngineBase' objects}
      128    0.387    0.003    0.387    0.003 {built-in method torch.nonzero}
     1328    0.006    0.000    0.333    0.000 eval_frame.py:1039(_fn)
  496/416    0.004    0.000    0.283    0.001 utils.py:119(call_func_at_runtime_with_args)
 7900/467    0.010    0.000    0.275    0.001 module.py:1771(_wrapped_call_impl)
 7900/467    0.012    0.000    0.274    0.001 module.py:1779(_call_impl)
      416    0.003    0.000    0.257    0.001 output_code.py:590(__call__)
      416    0.002    0.000    0.222    0.001 compile_fx.py:1767(run)
      416    0.000    0.000    0.219    0.001 cudagraph_trees.py:378(deferred_cudagraphify)
      416    0.001    0.000    0.219    0.001 utils.py:3013(run)
  752/416    0.005    0.000    0.214    0.001 cudagraph_trees.py:2008(run)
      129    0.001    0.000    0.213    0.002 policy.py:280(predict_values)
  752/416    0.001    0.000    0.209    0.001 cudagraph_trees.py:2073(_run)
      416    0.003    0.000    0.195    0.000 cudagraph_trees.py:2241(execute_node)
        6    0.177    0.029    0.177    0.029 {method 'item' of 'torch._C.TensorBase' objects}
      416    0.002    0.000    0.167    0.000 cudagraph_trees.py:1105(run)
      336    0.001    0.000    0.165    0.000 aot_autograd.py:1126(forward)
      336    0.001    0.000    0.164    0.000 runtime_wrappers.py:310(runtime_wrapper)
      416    0.001    0.000    0.152    0.000 cudagraph_trees.py:1219(run_graph)
      129    0.001    0.000    0.145    0.001 policy.py:189(forward_critic)
       80    0.015    0.000    0.144    0.002 function.py:300(apply)
      336    0.001    0.000    0.140    0.000 runtime_wrappers.py:512(wrapper)
       80    0.000    0.000    0.129    0.002 runtime_wrappers.py:2239(backward)
       80    0.002    0.000    0.129    0.002 runtime_wrappers.py:2288(impl_fn)
      129    0.000    0.000    0.127    0.001 policy.py:145(_get_shared_features)
      129    0.016    0.000    0.126    0.001 policy.py:99(forward)
     1290    0.007    0.000    0.122    0.000 container.py:245(forward)
       80    0.000    0.000    0.121    0.002 runtime_wrappers.py:2330(_backward_impl)
       80    0.001    0.000    0.115    0.001 cvum5n6kkktntvefslklrvfnu6723krbu57mgehxmrnkcehcu2ku.py:5981(call)
      416    0.095    0.000    0.095    0.000 graphs.py:139(replay)
      128    0.011    0.000    0.091    0.001 env.py:836(_step_and_reset_core)
     1564    0.074    0.000    0.074    0.000 {method 'clone' of 'torch._C.TensorBase' objects}
      208    0.000    0.000    0.068    0.000 runtime_wrappers.py:716(inner_fn)
      129    0.002    0.000    0.065    0.001 policy.py:48(forward)
      128    0.001    0.000    0.065    0.001 cxivc4vfgpjs6yln6ux2zqyo2mhgkkogbuwgd2mvkdgawklbb3ik.py:12170(call)
   240/80    0.004    0.000    0.063    0.001 clip_grad.py:41(_no_grad_wrapper)
       80    0.009    0.000    0.062    0.001 ppo.py:74(forward)
       80    0.002    0.000    0.061    0.001 clip_grad.py:185(clip_grad_norm_)




================================================================================
PROFILING RESULTS - Top by Total Time
================================================================================
         615979 function calls (569093 primitive calls) in 2.705 seconds

   Ordered by: internal time
   List reduced from 561 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       80    1.139    0.014    1.283    0.016 {method 'run_backward' of 'torch._C._EngineBase' objects}
      128    0.387    0.003    0.387    0.003 {built-in method torch.nonzero}
        6    0.177    0.029    0.177    0.029 {method 'item' of 'torch._C.TensorBase' objects}
      416    0.095    0.000    0.095    0.000 graphs.py:139(replay)
     1564    0.074    0.000    0.074    0.000 {method 'clone' of 'torch._C.TensorBase' objects}
     1419    0.050    0.000    0.050    0.000 {built-in method torch._C._nn.linear}
      416    0.048    0.000    0.048    0.000 {built-in method torch._foreach_copy_}
      128    0.026    0.000    0.026    0.000 {built-in method torch.multinomial}
      508    0.024    0.000    0.024    0.000 {method 'cpu' of 'torch._C.TensorBase' objects}
      256    0.022    0.000    0.022    0.000 {built-in method torch._foreach_add}
     1161    0.022    0.000    0.022    0.000 {built-in method torch.layer_norm}
      516    0.019    0.000    0.019    0.000 {built-in method torch.embedding}
     1290    0.019    0.000    0.019    0.000 {built-in method torch.relu}
      129    0.016    0.000    0.126    0.001 policy.py:99(forward)
       80    0.015    0.000    0.144    0.002 function.py:300(apply)
      128    0.013    0.000    0.015    0.000 rollout.py:204(add)
 7900/467    0.012    0.000    0.274    0.001 module.py:1779(_call_impl)
      258    0.012    0.000    0.015    0.000 embeddings.py:771(forward)
        1    0.011    0.011    0.013    0.013 rollout.py:244(compute_returns_and_advantage)
      127    0.011    0.000    0.039    0.000 ppo.py:407(_handle_done_episodes)
      128    0.011    0.000    0.091    0.001 env.py:836(_step_and_reset_core)
       80    0.010    0.000    0.010    0.000 {built-in method torch._foreach_norm}
 7900/467    0.010    0.000    0.275    0.001 module.py:1771(_wrapped_call_impl)
      576    0.010    0.000    0.010    0.000 {built-in method torch._ops.profiler._record_function_enter_new}
      128    0.009    0.000    0.055    0.000 policy.py:285(get_logits)
      640    0.009    0.000    0.009    0.000 {built-in method torch.index_select}
       80    0.009    0.000    0.062    0.001 ppo.py:74(forward)
     5055    0.008    0.000    0.008    0.000 {method 'to' of 'torch._C.TensorBase' objects}
32400/4880    0.008    0.000    0.010    0.000 module.py:2823(named_modules)
      760    0.008    0.000    0.008    0.000 {method 'copy_' of 'torch._C.TensorBase' objects}
66146/65902    0.007    0.000    0.008    0.000 {built-in method builtins.isinstance}
      416    0.007    0.000    0.010    0.000 cudagraph_trees.py:1126(reconstruct_outputs)
      343    0.007    0.000    0.007    0.000 {method 'mean' of 'torch._C.TensorBase' objects}
     1290    0.007    0.000    0.122    0.000 container.py:245(forward)
       80    0.007    0.000    0.010    0.000 adam.py:138(_init_group)
     1328    0.006    0.000    0.333    0.000 eval_frame.py:1039(_fn)
     8400    0.006    0.000    0.011    0.000 cudagraph_trees.py:534(expired)
      316    0.006    0.000    0.006    0.000 {built-in method torch.where}
       80    0.005    0.000    0.013    0.000 optimizer.py:997(zero_grad)
      416    0.005    0.000    0.056    0.000 cudagraph_trees.py:1057(_copy_inputs_and_remove_from_src)




Results saved to /home/castellanoontiv/Batched_env/kge_experiments/tests/profile_learn_results.txt
