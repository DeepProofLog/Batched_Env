Profile Optimized Learn Results
Date: 2025-12-18 02:36:22
Device: cuda
Dataset: countries_s3

Configuration:
  Total timesteps (profiled): 1
  Batch size env: 128
  N steps per rollout: 20
  N epochs: 2
  Minibatch size: 640
  Compile mode: reduce-overhead
  Fullgraph: True


Setting up components...
Queries loaded - Train: 111/111, Valid: 24, Test: 24
Compiling policy network and loss module for training...
Initialization time: 3.08s

Running warmup (compilation + first rollout)...
Compiling env.step (mode='reduce-overhead', fullgraph=True)...
Warmup: Running learn() iteration to compile all graphs...

Collecting rollouts
Rollout: 0/20
Rollout: 4/20
Rollout: 8/20
Rollout: 12/20
Rollout: 16/20
Rollout collected in 6.35s. FPS: 403.12


Training
Epoch 1/2
Epoch 2/2
Training completed in 18.93s
Iteration 1, timesteps: 2560/20.  total loss: 1.5939, policy_loss: 0.0074, value_loss: 1.5864, entropy_loss: 0.0210, approx_kl: 0.0484, clip_fraction: 0.0258, explained_var: -1.8152

Warmup time: 25.41s

Profiling training for 1 timesteps...

Collecting rollouts
Rollout: 0/20
Rollout: 4/20
Rollout: 8/20
Rollout: 12/20
Rollout: 16/20
Rollout collected in 0.20s. FPS: 13096.15


Training
Epoch 1/2
Epoch 2/2
Training completed in 0.12s
Iteration 1, timesteps: 5120/2561.  total loss: 1.3037, policy_loss: 0.0000, value_loss: 1.3036, entropy_loss: 0.0235, approx_kl: 0.0068, clip_fraction: 0.0199, explained_var: -1.4739


================================================================================
TIMING SUMMARY
================================================================================
Init time:         3.0751s
Warmup time:       25.4088s
Runtime:           0.3318s
Total time:        25.7406s
Steps/second:      7716.4
Total timesteps:   5120 (Warmup: 2560, Profiled: 2560)

Last training metrics:
  policy_loss: 0.0000
  value_loss: 1.3036
  entropy: 0.0235
  clip_fraction: 0.0199
  approx_kl: 0.0068
  explained_var: -1.4739

================================================================================
PROFILING RESULTS - Top by Cumulative Time
================================================================================
         80617 function calls (74557 primitive calls) in 0.324 seconds

   Ordered by: cumulative time
   List reduced from 527 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        6    0.062    0.010    0.062    0.010 {method 'item' of 'torch._C.TensorBase' objects}
  1276/71    0.002    0.000    0.060    0.001 module.py:1771(_wrapped_call_impl)
  1276/71    0.003    0.000    0.060    0.001 module.py:1779(_call_impl)
       20    0.051    0.003    0.051    0.003 {built-in method torch.nonzero}
       21    0.000    0.000    0.051    0.002 policy.py:280(predict_values)
      176    0.001    0.000    0.050    0.000 eval_frame.py:1039(_fn)
     30/4    0.001    0.000    0.042    0.011 eval_frame.py:791(compile_wrapper)
    64/56    0.001    0.000    0.041    0.001 utils.py:119(call_func_at_runtime_with_args)
       56    0.001    0.000    0.036    0.001 output_code.py:590(__call__)
       48    0.000    0.000    0.036    0.001 aot_autograd.py:1126(forward)
       48    0.000    0.000    0.036    0.001 runtime_wrappers.py:310(runtime_wrapper)
       21    0.000    0.000    0.035    0.002 policy.py:189(forward_critic)
       48    0.000    0.000    0.031    0.001 runtime_wrappers.py:512(wrapper)
       21    0.000    0.000    0.031    0.001 policy.py:145(_get_shared_features)
       21    0.004    0.000    0.030    0.001 policy.py:99(forward)
      210    0.002    0.000    0.029    0.000 container.py:245(forward)
       56    0.000    0.000    0.028    0.001 compile_fx.py:1767(run)
       56    0.000    0.000    0.028    0.001 cudagraph_trees.py:378(deferred_cudagraphify)
       56    0.000    0.000    0.028    0.001 utils.py:3013(run)
        1    0.000    0.000    0.027    0.027 env.py:969(step_and_reset)
   104/56    0.001    0.000    0.027    0.000 cudagraph_trees.py:2008(run)
   104/56    0.000    0.000    0.026    0.000 cudagraph_trees.py:2073(_run)
       56    0.000    0.000    0.023    0.000 cudagraph_trees.py:2241(execute_node)
       20    0.003    0.000    0.021    0.001 env.py:836(_step_and_reset_core)
        1    0.000    0.000    0.019    0.019 env.py:299(reset)
       56    0.000    0.000    0.019    0.000 cudagraph_trees.py:1105(run)
        8    0.000    0.000    0.017    0.002 __init__.py:243(backward)
        8    0.000    0.000    0.017    0.002 graph.py:832(_engine_run_backward)
        1    0.000    0.000    0.016    0.016 env.py:603(_reset_from_queries)
        8    0.007    0.001    0.016    0.002 {method 'run_backward' of 'torch._C._EngineBase' objects}
       56    0.000    0.000    0.016    0.000 cudagraph_trees.py:1219(run_graph)
        1    0.004    0.004    0.015    0.015 env.py:1139(_compute_derived)
       20    0.003    0.000    0.015    0.001 policy.py:285(get_logits)
       21    0.000    0.000    0.015    0.001 policy.py:48(forward)
       20    0.000    0.000    0.014    0.001 cxivc4vfgpjs6yln6ux2zqyo2mhgkkogbuwgd2mvkdgawklbb3ik.py:12170(call)
       40    0.000    0.000    0.014    0.000 base.py:12480(clone)
       40    0.000    0.000    0.014    0.000 _td.py:3261(_clone)
       40    0.001    0.000    0.014    0.000 base.py:10716(_clone_recurse)
      231    0.000    0.000    0.013    0.000 linear.py:130(forward)
      231    0.013    0.000    0.013    0.000 {built-in method torch._C._nn.linear}




================================================================================
PROFILING RESULTS - Top by Total Time
================================================================================
         80617 function calls (74557 primitive calls) in 0.324 seconds

   Ordered by: internal time
   List reduced from 527 to 40 due to restriction <40>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        6    0.062    0.010    0.062    0.010 {method 'item' of 'torch._C.TensorBase' objects}
       20    0.051    0.003    0.051    0.003 {built-in method torch.nonzero}
      231    0.013    0.000    0.013    0.000 {built-in method torch._C._nn.linear}
       56    0.010    0.000    0.010    0.000 {built-in method torch._foreach_copy_}
        8    0.007    0.001    0.016    0.002 {method 'run_backward' of 'torch._C._EngineBase' objects}
       20    0.007    0.000    0.007    0.000 {built-in method torch.multinomial}
      232    0.006    0.000    0.006    0.000 {method 'clone' of 'torch._C.TensorBase' objects}
       40    0.006    0.000    0.006    0.000 {built-in method torch._foreach_add}
       76    0.005    0.000    0.005    0.000 {method 'cpu' of 'torch._C.TensorBase' objects}
      189    0.005    0.000    0.005    0.000 {built-in method torch.layer_norm}
       84    0.004    0.000    0.004    0.000 {built-in method torch.embedding}
      210    0.004    0.000    0.004    0.000 {built-in method torch.relu}
        1    0.004    0.004    0.015    0.015 env.py:1139(_compute_derived)
       21    0.004    0.000    0.030    0.001 policy.py:99(forward)
       20    0.004    0.000    0.004    0.000 rollout.py:204(add)
       56    0.003    0.000    0.003    0.000 graphs.py:139(replay)
        1    0.003    0.003    0.003    0.003 rollout.py:244(compute_returns_and_advantage)
  1276/71    0.003    0.000    0.060    0.001 module.py:1779(_call_impl)
       19    0.003    0.000    0.009    0.000 ppo.py:513(_handle_done_episodes)
       20    0.003    0.000    0.021    0.001 env.py:836(_step_and_reset_core)
      100    0.003    0.000    0.003    0.000 {built-in method torch.where}
       20    0.003    0.000    0.015    0.001 policy.py:285(get_logits)
       42    0.003    0.000    0.003    0.000 embeddings.py:771(forward)
      591    0.002    0.000    0.002    0.000 {method 'to' of 'torch._C.TensorBase' objects}
        8    0.002    0.000    0.009    0.001 function.py:300(apply)
  1276/71    0.002    0.000    0.060    0.001 module.py:1771(_wrapped_call_impl)
       72    0.002    0.000    0.002    0.000 {built-in method torch._ops.profiler._record_function_enter_new}
        8    0.002    0.000    0.002    0.000 {built-in method torch._foreach_norm}
       55    0.002    0.000    0.002    0.000 {method 'mean' of 'torch._C.TensorBase' objects}
      210    0.002    0.000    0.029    0.000 container.py:245(forward)
8690/8446    0.001    0.000    0.002    0.000 {built-in method builtins.isinstance}
       64    0.001    0.000    0.001    0.000 {built-in method torch.index_select}
        8    0.001    0.000    0.010    0.001 ppo.py:74(forward)
        9    0.001    0.000    0.001    0.000 {built-in method torch.cat}
       88    0.001    0.000    0.001    0.000 {method 'copy_' of 'torch._C.TensorBase' objects}
 3240/488    0.001    0.000    0.002    0.000 module.py:2823(named_modules)
       56    0.001    0.000    0.002    0.000 cudagraph_trees.py:1126(reconstruct_outputs)
       38    0.001    0.000    0.001    0.000 {method 'masked_fill_' of 'torch._C.TensorBase' objects}
      144    0.001    0.000    0.001    0.000 {method 'squeeze' of 'torch._C.TensorBase' objects}
        8    0.001    0.000    0.002    0.000 adam.py:138(_init_group)




Results saved to /home/castellanoontiv/Batched_env/kge_experiments/tests/profile_learn_results.txt
